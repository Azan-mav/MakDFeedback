<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Projects Management</title>
  <style>
    body{
      margin:0;
      font-family: Arial, sans-serif;
      background:#f3f5fb;
      color:#111827;
    }
    header{
      background:#111827;
      color:#fff;
      padding:14px 24px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    header h1{
      font-size:20px;
      margin:0;
    }
    nav a{
      color:#e5e7eb;
      margin-left:18px;
      text-decoration:none;
      font-size:14px;
    }
    nav a:hover{
      text-decoration:underline;
    }
    .container{
      padding:24px;
      max-width:900px;
      margin:0 auto;
    }
    .card{
      background:#ffffff;
      border-radius:10px;
      padding:16px 18px;
      box-shadow:0 4px 10px rgba(15,23,42,0.06);
      margin-bottom:20px;
    }
    h2{
      margin-top:0;
      margin-bottom:12px;
      font-size:18px;
    }
    form.inline{
      display:flex;
      gap:8px;
      margin-top:8px;
    }
    input[type="text"]{
      flex:1;
      padding:8px;
      box-sizing:border-box;
    }
    button{
      padding:8px 12px;
      border:none;
      border-radius:6px;
      cursor:pointer;
      font-size:13px;
    }
    .btn-primary{
      background:#2563eb;
      color:#fff;
    }
    .btn-secondary{
      background:#e5e7eb;
      color:#111827;
    }
    table{
      width:100%;
      border-collapse:collapse;
      font-size:14px;
    }
    th, td{
      padding:8px 10px;
      border-bottom:1px solid #e5e7eb;
      text-align:left;
    }
    th{
      background:#f9fafb;
    }
    tbody tr:hover{
      background:#f3f4ff;
    }
  </style>
</head>
<body>
  <header>
    <h1>MakD Feedback â€” Projects</h1>
    <nav>
      <a href="dashboard.html">Dashboard</a>
      <a href="projects.html">Projects</a>
      <a href="#" id="logoutLink">Logout</a>
    </nav>
  </header>

  <div class="container">
    <div class="card">
      <h2>Add Project</h2>
      <form id="addForm" class="inline" autocomplete="off">
        <input type="text" id="projectName" placeholder="Project name" required>
        <button class="btn-primary" type="submit">Add</button>
      </form>
    </div>

    <div class="card">
      <h2>All Projects</h2>
      <table>
        <thead>
          <tr>
            <th style="width:120px;">ID</th>
            <th>Name</th>
            <th style="width:160px;">Actions</th>
          </tr>
        </thead>
        <tbody id="projectsBody">
        </tbody>
      </table>
    </div>
  </div>

  <script>
    (function(){
      if (localStorage.getItem("mst_admin_logged_in") !== "1"){
        window.location.href = "login.html";
        return;
      }

      document.getElementById("logoutLink").addEventListener("click", function(e){
        e.preventDefault();
        localStorage.removeItem("mst_admin_logged_in");
        window.location.href = "login.html";
      });

      const tbody   = document.getElementById("projectsBody");
      const addForm = document.getElementById("addForm");
      const nameInp = document.getElementById("projectName");

      let projects = [];

      function render(){
        tbody.innerHTML = "";
        if (!projects.length){
          const tr = document.createElement("tr");
          const td = document.createElement("td");
          td.colSpan = 3;
          td.textContent = "No projects yet.";
          tbody.appendChild(tr);
          tr.appendChild(td);
          return;
        }
        projects.forEach(function(p, idx){
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${p.id}</td>
            <td>
              <input type="text" value="${p.name.replace(/"/g,'&quot;')}" data-idx="${idx}" style="width:100%; padding:4px 6px; box-sizing:border-box;">
            </td>
            <td>
              <button class="btn-secondary" data-action="save" data-idx="${idx}">Save</button>
              <button class="btn-secondary" data-action="delete" data-idx="${idx}" style="margin-left:6px;">Delete</button>
            </td>
          `;
          tbody.appendChild(tr);
        });
      }

      function persist(){
        try {
          localStorage.setItem("mst_projects", JSON.stringify(projects));
        } catch(e){
          console.warn("Could not save projects", e);
        }
      }

      // initial load: from localStorage, or seed from data/projects.json
      (function init(){
        try {
          projects = JSON.parse(localStorage.getItem("mst_projects") || "[]");
        } catch(e){ projects = []; }

        if (projects && projects.length){
          render();
        } else {
          fetch("../data/projects.json")
            .then(r => r.json())
            .then(function(data){
              projects = Array.isArray(data) ? data : [];
              persist();
              render();
            })
            .catch(function(){
              projects = [];
              render();
            });
        }
      })();

      addForm.addEventListener("submit", function(e){
        e.preventDefault();
        const name = nameInp.value.trim();
        if (!name) return;
        const id = Date.now().toString().slice(-6);
        projects.push({ id:id, name:name });
        persist();
        render();
        nameInp.value = "";
      });

      tbody.addEventListener("click", function(e){
        const btn = e.target.closest("button");
        if (!btn) return;
        const idx = parseInt(btn.getAttribute("data-idx"), 10);
        const action = btn.getAttribute("data-action");
        if (isNaN(idx) || !projects[idx]) return;

        if (action === "delete"){
          if (confirm("Delete this project?")){
            projects.splice(idx, 1);
            persist();
            render();
          }
        } else if (action === "save"){
          const inp = tbody.querySelector('input[data-idx="'+idx+'"]');
          if (!inp) return;
          const newName = inp.value.trim();
          if (!newName) return;
          projects[idx].name = newName;
          persist();
          render();
        }
      });
    })();
  </script>
</body>
</html>
